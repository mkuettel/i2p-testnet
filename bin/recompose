#!/usr/bin/env bash

set -eu -o pipefail

script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

getconf() {
    local attr="$1"
    jq ".$attr" < "$script_dir/../config.json"
}


network_name="$(getconf 'network.name')"


if docker network list | grep -F "$network_name"; then
    echo "Removing network $network_name as it already exists."
    docker network rm "$network_name"
fi


docker-compose -f docker/i2p-testnet.yml up \
    --build \
    --remove-orphans \
    --force-recreate \
    --scale i2pd="$(getconf 'nodes.amount')"
